{% extends 'admin/base.html.twig' %} {% block page_title %}Users Management{%
endblock %} {% block admin_stylesheets %}
<link rel="stylesheet" href="{{ asset('css/admin/users.css') }}" />
{% endblock %} {% block admin_content %}
<div class="users-container">
    {# Tabs Navigation #}
    <ul class="nav nav-tabs users-tabs" id="usersTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button
                class="nav-link active"
                id="students-tab"
                data-bs-toggle="tab"
                data-bs-target="#students"
                type="button"
                role="tab"
            >
                <i class="fas fa-user-graduate"></i> Students ({{
                    students | length
                }})
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button
                class="nav-link"
                id="companies-tab"
                data-bs-toggle="tab"
                data-bs-target="#companies"
                type="button"
                role="tab"
            >
                <i class="fas fa-building"></i> Companies ({{
                    companies | length
                }})
            </button>
        </li>
    </ul>

    {# Tabs Content #}
    <div class="tab-content" id="usersTabsContent">
        {# ========================================= #} {# STUDENTS TAB #} {#
        ========================================= #}
        <div class="tab-pane fade show active" id="students" role="tabpanel">
            <div class="tab-pane-header">
                <h3><i class="fas fa-user-graduate"></i> Students List</h3>

                {# Search Bar #}
                <form
                    method="GET"
                    action="{{ path('admin_users') }}"
                    class="search-form"
                >
                    <div class="input-group">
                        <input
                            type="text"
                            name="student_search"
                            class="form-control"
                            placeholder="Search students by name or email..."
                            value="{{ studentSearch }}"
                        />
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> Search
                        </button>
                        {% if studentSearch %}
                        <a
                            href="{{ path('admin_users') }}"
                            class="btn btn-secondary"
                        >
                            <i class="fas fa-times"></i> Clear
                        </a>
                        {% endif %}
                    </div>
                </form>
            </div>

            {# Students Table #}
            <div class="table-responsive">
                {% if students is empty %}
                <div class="empty-state">
                    <i class="fas fa-users-slash"></i>
                    <p>No students found</p>
                </div>
                {% else %}
                <table class="table table-hover users-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Skills</th>
                            <th>Registered</th>
                            <th>Applications</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for student in students %}
                        <tr>
                            <td>#{{ student.id }}</td>
                            <td>
                                <div class="user-name">
                                    <i class="fas fa-user-circle"></i>
                                    <span
                                        >{{ student.firstName }}
                                        {{ student.lastName }}</span
                                    >
                                </div>
                            </td>
                            <td>{{ student.email }}</td>
                            <td>
                                {% if student.skills|length > 0 %}
                                <div class="skills-preview">
                                    {% for skill in student.skills|slice(0, 2)
                                    %}
                                    <span class="skill-tag">{{ skill }}</span>
                                    {% endfor %} {% if student.skills|length > 2
                                    %}
                                    <span class="skill-tag-more"
                                        >+{{ student.skills|length - 2 }}</span
                                    >
                                    {% endif %}
                                </div>
                                {% else %}
                                <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>{{ student.createdAt|date('M d, Y') }}</td>
                            <td>
                                <span class="badge badge-info">
                                    {{ student.applications | length }}
                                    applications
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    {# View Button #}
                                    <button
                                        type="button"
                                        class="btn btn-sm btn-info"
                                        onclick="viewStudentDetails({{
                                            student.id
                                        }})"
                                        title="View Details"
                                    >
                                        <i class="fas fa-eye"></i>
                                    </button>

                                    {# Bouton Delete qui ouvre le modal #}
                                    <button
                                        type="button"
                                        class="btn btn-sm btn-danger"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteStudentModal{{
                                            student.id
                                        }}"
                                        title="Delete Student"
                                    >
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% for student in students %} {# Modal Delete Student #}
                <div
                    class="modal fade"
                    id="deleteStudentModal{{ student.id }}"
                    tabindex="-1"
                    aria-labelledby="deleteStudentModalLabel{{ student.id }}"
                    aria-hidden="true"
                >
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            {# Header #}
                            <div class="modal-header bg-danger text-white">
                                <h5
                                    class="modal-title"
                                    id="deleteStudentModalLabel{{ student.id }}"
                                >
                                    <i
                                        class="fas fa-exclamation-triangle me-2"
                                    ></i>
                                    Confirm Deletion
                                </h5>
                                <button
                                    type="button"
                                    class="btn-close btn-close-white"
                                    data-bs-dismiss="modal"
                                    aria-label="Close"
                                ></button>
                            </div>

                            {# Body #}
                            <div class="modal-body">
                                <p class="mb-3">
                                    <strong
                                        >Are you sure you want to delete this
                                        student account?</strong
                                    >
                                </p>

                                <div class="alert alert-light border">
                                    <p class="mb-1">
                                        <i class="fas fa-user text-primary"></i>
                                        <strong
                                            >{{ student.firstName }}
                                            {{ student.lastName }}</strong
                                        >
                                    </p>
                                    <p class="mb-1">
                                        <i
                                            class="fas fa-envelope text-muted"
                                        ></i>
                                        {{ student.email }}
                                    </p>
                                    <p class="mb-0">
                                        <i
                                            class="fas fa-file-alt text-muted"
                                        ></i>
                                        {{
                                            student.applications | length
                                        }}
                                        application(s)
                                    </p>
                                </div>

                                <div class="alert alert-warning mb-0">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <strong>Warning:</strong> This action cannot
                                    be undone. All student data and applications
                                    will be permanently deleted.
                                </div>
                            </div>

                            {# Footer #}
                            <div class="modal-footer">
                                <button
                                    type="button"
                                    class="btn btn-secondary"
                                    data-bs-dismiss="modal"
                                >
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                <form
                                    method="POST"
                                    action="{{
                                        path('admin_student_delete', {
                                            id: student.id
                                        })
                                    }}"
                                    style="display: inline"
                                >
                                    <button
                                        type="submit"
                                        class="btn btn-danger"
                                    >
                                        <i class="fas fa-trash"></i> Delete
                                        Student
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %} 
                {% endif %}
            </div>
        </div>

        {# ========================================= #} {# COMPANIES TAB #} {#
        ========================================= #}
        <div class="tab-pane fade" id="companies" role="tabpanel">
            <div class="tab-pane-header">
                <h3><i class="fas fa-building"></i> Companies List</h3>

                {# Search Bar #}
                <form
                    method="GET"
                    action="{{ path('admin_users') }}"
                    class="search-form"
                >
                    <div class="input-group">
                        <input
                            type="text"
                            name="company_search"
                            class="form-control"
                            placeholder="Search companies by name, email or industry..."
                            value="{{ companySearch }}"
                        />
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> Search
                        </button>
                        {% if companySearch %}
                        <a
                            href="{{ path('admin_users') }}"
                            class="btn btn-secondary"
                        >
                            <i class="fas fa-times"></i> Clear
                        </a>
                        {% endif %}
                    </div>
                </form>
            </div>

            {# Companies Table #}
            <div class="table-responsive">
                {% if companies is empty %}
                <div class="empty-state">
                    <i class="fas fa-building-slash"></i>
                    <p>No companies found</p>
                </div>
                {% else %}
                <table class="table table-hover users-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Company Name</th>
                            <th>Email</th>
                            <th>Industry</th>
                            <th>Location</th>
                            <th>Verified</th>
                            <th>Internships</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for company in companies %}
                        <tr>
                            <td>#{{ company.id }}</td>
                            <td>
                                <div class="user-name">
                                    <i class="fas fa-building"></i>
                                    <span>{{ company.companyName }}</span>
                                </div>
                            </td>
                            <td>{{ company.email }}</td>
                            <td>
                                <span class="industry-badge">
                                    {{ company.industry }}
                                </span>
                            </td>
                            <td>{{ company.location }}</td>
                            <td>
                                {% if company.isVerified %}
                                <span class="badge badge-success">
                                    <i class="fas fa-check-circle"></i> Verified
                                </span>
                                {% else %}
                                <span class="badge badge-warning">
                                    <i class="fas fa-clock"></i> Unverified
                                </span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge badge-info">
                                    {{ company.internships | length }}
                                    internships
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    {# View Button #}
                                    <button
                                        type="button"
                                        class="btn btn-sm btn-info"
                                        onclick="viewCompanyDetails({{
                                            company.id
                                        }})"
                                        title="View Details"
                                    >
                                        <i class="fas fa-eye"></i>
                                    </button>

                                    {# Toggle Verification Button #}
                                    <form
                                        method="POST"
                                        action="{{
                                            path(
                                                'admin_company_toggle_verification',
                                                { id: company.id }
                                            )
                                        }}"
                                        style="display: inline"
                                    >
                                        <button
                                            type="submit"
                                            class="btn btn-sm {{
                                                company.isVerified
                                                    ? 'btn-warning'
                                                    : 'btn-success'
                                            }}"
                                            title="{{
                                                company.isVerified
                                                    ? 'Unverify'
                                                    : 'Verify'
                                            }}"
                                        >
                                            <i
                                                class="fas {{
                                                    company.isVerified
                                                        ? 'fa-times-circle'
                                                        : 'fa-check-circle'
                                                }}"
                                            ></i>
                                        </button>
                                    </form>

                                    {# Bouton Delete qui ouvre le modal #}
                                    <button
                                        type="button"
                                        class="btn btn-sm btn-danger"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteCompanyModal{{
                                            company.id
                                        }}"
                                        title="Delete Company"
                                    >
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% for company in companies %} {# Modal Delete Company #}
                <div
                    class="modal fade"
                    id="deleteCompanyModal{{ company.id }}"
                    tabindex="-1"
                    aria-labelledby="deleteCompanyModalLabel{{ company.id }}"
                    aria-hidden="true"
                >
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            {# Header #}
                            <div class="modal-header bg-danger text-white">
                                <h5
                                    class="modal-title"
                                    id="deleteCompanyModalLabel{{ company.id }}"
                                >
                                    <i
                                        class="fas fa-exclamation-triangle me-2"
                                    ></i>
                                    Confirm Deletion
                                </h5>
                                <button
                                    type="button"
                                    class="btn-close btn-close-white"
                                    data-bs-dismiss="modal"
                                    aria-label="Close"
                                ></button>
                            </div>

                            {# Body #}
                            <div class="modal-body">
                                <p class="mb-3">
                                    <strong
                                        >Are you sure you want to delete this
                                        company account?</strong
                                    >
                                </p>

                                <div class="alert alert-light border">
                                    <p class="mb-1">
                                        <i class="fas fa-user text-primary"></i>
                                        <strong
                                            >{{ company.companyName }}</strong>
                                    </p>
                                    <p class="mb-1">
                                        <i
                                            class="fas fa-envelope text-muted"
                                        ></i>
                                        {{ company.email }}
                                    </p>
                                    <p class="mb-0">
                                        <i
                                            class="fas fa-file-alt text-muted"
                                        ></i>
                                        {{
                                            company.internships | length
                                        }}
                                        internship(s)
                                    </p>
                                </div>

                                <div class="alert alert-warning mb-0">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <strong>Warning:</strong> This action cannot
                                    be undone. All company data and internships
                                    will be permanently deleted.
                                </div>
                            </div>

                            {# Footer #}
                            <div class="modal-footer">
                                <button
                                    type="button"
                                    class="btn btn-secondary"
                                    data-bs-dismiss="modal"
                                >
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                <form
                                    method="POST"
                                    action="{{
                                        path('admin_company_delete', {
                                            id: company.id
                                        })
                                    }}"
                                    style="display: inline"
                                >
                                    <button
                                        type="submit"
                                        class="btn btn-danger"
                                    >
                                        <i class="fas fa-trash"></i> Delete
                                        Company
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

{# Student Details Modal #}
<div
    class="modal fade"
    id="studentDetailsModal"
    tabindex="-1"
    aria-hidden="true"
>
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-user-graduate"></i> Student Details
                </h5>
                <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                ></button>
            </div>
            <div class="modal-body" id="studentDetailsBody">
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                >
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

{# Company Details Modal #}
<div
    class="modal fade"
    id="companyDetailsModal"
    tabindex="-1"
    aria-hidden="true"
>
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-building"></i> Company Details
                </h5>
                <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                ></button>
            </div>
            <div class="modal-body" id="companyDetailsBody">
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                >
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %} {% block admin_javascripts %}
<script src="{{ asset('js/admin/users.js') }}"></script>
{% endblock %}
