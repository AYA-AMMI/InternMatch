{% extends 'student/base.html.twig' %} {% block title %}{{ internship.title }} -
InternMatch{% endblock %} {% block student_content %}
<div class="container-fluid py-4">
    {# Back Button #}
    <div class="mb-3">
        <a
            href="{{ path('student_internships') }}"
            class="btn btn-outline-secondary"
        >
            <i class="fas fa-arrow-left me-2"></i>
            Back to Browse
        </a>
    </div>

    <div class="row">
        {# Main Content #}
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-4">
                    {# Header #}
                    <div
                        class="d-flex justify-content-between align-items-start mb-4"
                    >
                        <div>
                            <h1 class="h3 mb-2">{{ internship.title }}</h1>
                            <p class="text-muted mb-0">
                                <i class="fas fa-building me-2"></i>
                                {{ internship.company.companyName }}
                            </p>
                        </div>
                        <span
                            class="badge match-badge match-{{
                                matchScore >= 90
                                    ? 'excellent'
                                    : matchScore >= 75
                                    ? 'good'
                                    : matchScore >= 60
                                    ? 'fair'
                                    : 'low'
                            }} fs-5"
                        >
                            {{ matchScore }}% Match
                        </span>
                    </div>

                    {# Match Score Visualization #}
                    <div class="mb-4 p-3 bg-light rounded">
                        <div
                            class="d-flex justify-content-between align-items-center mb-2"
                        >
                            <span class="fw-semibold"
                                >Your Compatibility Score</span
                            >
                            <span
                                class="fw-bold text-{{
                                    matchScore >= 90
                                        ? 'success'
                                        : matchScore >= 75
                                        ? 'info'
                                        : matchScore >= 60
                                        ? 'warning'
                                        : 'secondary'
                                }}"
                            >
                                {{ matchScore }}%
                            </span>
                        </div>
                        <div class="progress" style="height: 20px">
                            <div
                                class="progress-bar bg-{{
                                    matchScore >= 90
                                        ? 'success'
                                        : matchScore >= 75
                                        ? 'info'
                                        : matchScore >= 60
                                        ? 'warning'
                                        : 'secondary'
                                }}"
                                role="progressbar"
                                style="width: {{ matchScore }}%"
                                aria-valuenow="{{ matchScore }}"
                                aria-valuemin="0"
                                aria-valuemax="100"
                            >
                                {{ matchScore }}%
                            </div>
                        </div>
                        <small class="text-muted d-block mt-2">
                            {% if matchScore >= 90 %}
                            <i
                                class="fas fa-check-circle text-success me-1"
                            ></i>
                            Excellent match! Your profile aligns perfectly with
                            this position. {% elseif matchScore >= 75 %}
                            <i class="fas fa-check-circle text-info me-1"></i>
                            Good match! You meet most of the requirements. {%
                            elseif matchScore >= 60 %}
                            <i
                                class="fas fa-exclamation-circle text-warning me-1"
                            ></i>
                            Fair match. Some skills may need development. {%
                            else %}
                            <i
                                class="fas fa-info-circle text-secondary me-1"
                            ></i>
                            Consider building more relevant skills for this
                            position. {% endif %}
                        </small>
                    </div>

                    {# Description #}
                    <div class="mb-4">
                        <h5 class="mb-3">
                            <i class="fas fa-file-alt text-primary me-2"></i>
                            Description
                        </h5>
                        <p class="text-muted">{{ internship.description }}</p>
                    </div>

                    {# Required Skills #}
                    <div class="mb-4">
                        <h5 class="mb-3">
                            <i class="fas fa-code text-primary me-2"></i>
                            Required Skills
                        </h5>
                        <div>
                            {% set studentSkills = app.user.skills|map(s =>
                            s|lower) %} {% for skill in
                            internship.requiredSkills %} {% set hasSkill =
                            skill|lower in studentSkills %}
                            <span
                                class="badge {{
                                    hasSkill
                                        ? 'bg-success'
                                        : 'bg-light text-dark'
                                }} me-2 mb-2 p-2"
                            >
                                {% if hasSkill %}
                                <i class="fas fa-check-circle me-1"></i>
                                {% endif %}
                                {{ skill }}
                            </span>
                            {% endfor %}
                        </div>
                        <small class="text-muted d-block mt-2">
                            <i class="fas fa-info-circle me-1"></i>
                            Green badges indicate skills you already have
                        </small>
                    </div>

                    {# Company Description #}
                    <div class="mb-4">
                        <h5 class="mb-3">
                            <i class="fas fa-building text-primary me-2"></i>
                            About the Company
                        </h5>
                        <p class="text-muted">
                            {{
                                internship.company.description ??
                                    "No description available."
                            }}
                        </p>
                        {% if internship.company.website %}
                        <a
                            href="{{ internship.company.website }}"
                            target="_blank"
                            class="btn btn-sm btn-outline-primary"
                        >
                            <i class="fas fa-external-link-alt me-1"></i>
                            Visit Website
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {# Modal de confirmation #}
        <div
            class="modal fade"
            id="applyModal"
            tabindex="-1"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">
                            <i class="fas fa-paper-plane"></i> Submit
                            Application
                        </h5>
                        <button
                            type="button"
                            class="btn-close btn-close-white"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>

                    <div class="modal-body">
                        <h6 class="mb-3">You are applying for:</h6>

                        <div
                            class="internship-summary mb-4 p-3 bg-light rounded"
                        >
                            <h5 class="mb-2">{{ internship.title }}</h5>
                            <p class="mb-1">
                                <i class="fas fa-building text-primary"></i>
                                {{ internship.company.companyName }}
                            </p>
                            <p class="mb-1">
                                <i
                                    class="fas fa-map-marker-alt text-primary"
                                ></i>
                                {{ internship.location }}
                            </p>
                            <p class="mb-0">
                                <i class="fas fa-clock text-primary"></i>
                                {{ internship.duration }} months
                            </p>
                        </div>

                        <div class="match-score-display mb-4 text-center">
                            <div
                                class="score-circle mx-auto"
                                style="width: 120px; height: 120px; border-radius: 50%; 
                        border: 8px solid {% if matchScore >= 80 %}#10b981{% elseif matchScore >= 60 %}#3b82f6{% elseif matchScore >= 40 %}#f59e0b{% else %}#ef4444{% endif %};
                        display: flex; align-items: center; justify-content: center;"
                            >
                                <div>
                                    <h2 class="mb-0">{{ matchScore }}%</h2>
                                    <small>Match</small>
                                </div>
                            </div>
                        </div>

                        <form
                            method="POST"
                            action="{{
                                path('student_apply', { id: internship.id })
                            }}"
                            id="applyForm"
                        >
                            <div class="mb-3">
                                <label for="message" class="form-label">
                                    <i class="fas fa-comment"></i> Cover Message
                                    (Optional)
                                </label>
                                <textarea
                                    class="form-control"
                                    id="message"
                                    name="message"
                                    rows="4"
                                    placeholder="Explain why you're interested in this internship..."
                                ></textarea>
                            </div>

                            <div class="alert alert-info mb-0">
                                <i class="fas fa-info-circle"></i>
                                <strong>Note:</strong> The company will be able
                                to see your profile, skills, and this message.
                            </div>
                        </form>
                    </div>

                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                        >
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button
                            type="submit"
                            form="applyForm"
                            class="btn btn-primary"
                        >
                            <i class="fas fa-paper-plane"></i> Submit
                            Application
                        </button>
                    </div>
                </div>
            </div>
        </div>

        {# Sidebar #}
        <div class="col-lg-4">
            {# Quick Info Card #}
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="mb-3">Quick Info</h5>

                    <div class="mb-3">
                        <small class="text-muted d-block mb-1">
                            <i class="fas fa-industry me-2"></i>
                            Industry
                        </small>
                        <span class="badge bg-primary">{{
                            internship.company.industry
                        }}</span>
                    </div>

                    <div class="mb-3">
                        <small class="text-muted d-block mb-1">
                            <i class="fas fa-map-marker-alt me-2"></i>
                            Location
                        </small>
                        <strong>{{ internship.location }}</strong>
                    </div>

                    <div class="mb-3">
                        <small class="text-muted d-block mb-1">
                            <i class="fas fa-calendar-alt me-2"></i>
                            Duration
                        </small>
                        <strong>{{ internship.duration }} months</strong>
                    </div>

                    {% if internship.salary %}
                    <div class="mb-3">
                        <small class="text-muted d-block mb-1">
                            <i class="fas fa-dollar-sign me-2"></i>
                            Salary
                        </small>
                        <strong>DH {{ internship.salary }}</strong>
                    </div>
                    {% endif %}

                    <div class="mb-3">
                        <small class="text-muted d-block mb-1">
                            <i class="far fa-clock me-2"></i>
                            Posted
                        </small>
                        <strong
                            >{{ internship.postedAt|date('F d, Y') }}</strong
                        >
                    </div>

                    {% if internship.deadline %}
                    <div class="mb-3">
                        <small class="text-muted d-block mb-1">
                            <i class="fas fa-hourglass-half me-2"></i>
                            Deadline
                        </small>
                        <strong
                            class="text-danger"
                            >{{ internship.deadline|date('F d, Y') }}</strong
                        >
                    </div>
                    {% endif %}
                </div>
            </div>

            {# Application Card #}
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    {% if hasApplied %}
                    <div class="alert alert-success mb-3">
                        <i class="fas fa-check-circle me-2"></i>
                        You've already applied to this position
                    </div>

                    <div class="mb-3">
                        <strong>Application Status:</strong>
                        <span
                            class="badge bg-{{
                                application.status == 'pending'
                                    ? 'warning'
                                    : application.status == 'accepted'
                                    ? 'success'
                                    : 'danger'
                            }} ms-2"
                        >
                            {{ application.status | upper }}
                        </span>
                    </div>

                    <div class="mb-3">
                        <strong>Applied on:</strong>
                        {{ application.appliedAt|date('M d, Y') }}
                    </div>

                    <a
                        href="{{ path('student_applications') }}"
                        class="btn btn-primary w-100"
                    >
                        <i class="fas fa-file-alt me-2"></i>
                        View My Applications
                    </a>
                    {% else %}
                    <h5 class="mb-3">Ready to Apply?</h5>

                    <form
                        method="post"
                        action="{{
                            path('student_apply', { id: internship.id })
                        }}"
                        id="applyForm"
                    >
                        <button
                            type="button"
                            class="btn btn-primary btn-lg"
                            data-bs-toggle="modal"
                            data-bs-target="#applyModal"
                        >
                            <i class="fas fa-paper-plane"></i> Apply Now
                        </button>
                    </form>

                    <div class="alert alert-info mt-3 mb-0">
                        <small>
                            <i class="fas fa-info-circle me-1"></i>
                            Your profile and skills will be automatically shared
                            with the company.
                        </small>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} {% block stylesheets %}
{{ parent() }}
<link
    rel="stylesheet"
    href="{{ asset('css/student/internship_details.css') }}"
/>
{% endblock %} {% block javascripts %}
{{ parent() }}
<script src="{{ asset('js/student/internship_details.js') }}"></script>
{% endblock %}
